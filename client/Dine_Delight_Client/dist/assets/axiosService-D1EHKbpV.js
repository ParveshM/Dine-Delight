import{a as c}from"./axios-B6xwUs71.js";import{j as i}from"./index-VWaDGczM.js";import{a5 as n,a9 as l,e as h}from"./index-PhVsbpnH.js";import{l as k}from"./logout-DKSxkwX5.js";const u=c.create();u.defaults.withCredentials=!0;c.defaults.withCredentials=!0;let d="",a="";const p=()=>{const e=n.getState().UserSlice;d=e.access_token,a=e.refresh_token};n.subscribe(p);const f=async()=>{try{const{data:e}=await c.post(l+"/refresh_token",{refresh_token:a});return n.dispatch(h({access_token:e.access_token,refresh_token:a})),e==null?void 0:e.access_token}catch{k("Session expired ,please Login")}},g=async()=>{try{let e,o;const{data:t}=await c.get(l+"/accessToken",{params:{access_token:d}});e=t==null?void 0:t.access_token,o=t==null?void 0:t.user;const s=await i(e),{role:r}=s;return(r==="seller"||r==="user")&&o.isBlocked&&k("Your account has been blocked by administrator","error"),e}catch(e){console.log(e,"Error in getting token")}};u.interceptors.request.use(async e=>{let o=new Date,t,s;try{s=await g(),t=await i(s)}catch(r){console.log("error in decodeToken"+r)}return t.exp*1e3<o.getTime()&&(s=await f()),e.headers.Authorization="Bearer "+s,e});export{u as a};
