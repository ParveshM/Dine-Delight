import{r as n,Y as b,j as e,am as C,R as y,e as O}from"./index-B9ZM9xO7.js";import{a as v}from"./axiosService-CMzqa1ug.js";import{s as N}from"./toaster-CNrqpvc8.js";import{s as P}from"./util-CRi-jm_c.js";import{S as k}from"./square-pen-BzoKeAW4.js";import{b as I}from"./index-C450BYPU.js";import{C as T}from"./chevron-down-6YgtehVG.js";import{u as U,P as A}from"./usePaginateState-D5b6Cgt1.js";import"./axios-B6xwUs71.js";import"./index-VWaDGczM.js";import"./logout-IlbNoRIl.js";const E=({index:p,orderId:s,tableNumber:d,user:m,status:x,createdAt:c,orderItems:r,setShowModal:l})=>{const[t,g]=n.useState(null),[j,h]=n.useState(!1),u=b();return n.useEffect(()=>{u&&u.on("notify_updatedOrder",f=>{g(f)})},[]),n.useEffect(()=>{t&&r&&t.orderId===s&&t.orderItems.length>r.length&&h(!0)},[t,r]),e.jsxs("tr",{className:"bg-white border-b dark:bg-gray-800 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600",children:[e.jsx("td",{scope:"row",className:"px-6 py-4 font-medium text-gray-900 whitespace-nowrap dark:text-white",children:p}),e.jsx("td",{className:"px-6 py-4",children:s}),e.jsx("td",{className:"px-6 py-4",children:d}),e.jsx("td",{className:"px-6 py-4",children:m.name}),e.jsx("td",{className:"px-6 py-4",children:new Date(c).toLocaleString("en-US",{year:"numeric",month:"numeric",day:"numeric",hour:"numeric",minute:"numeric",hour12:!0})}),e.jsx("td",{className:`px-6 py-4 ${P(x)}`,children:x}),e.jsxs("td",{className:"px-6 py-4 flex gap-2 items-center",children:[e.jsx("div",{className:"w-4",children:j&&e.jsx(C,{title:"New items on order",className:"text-yellow-500 hover:cursor-pointer",onClick:()=>h(!1)})}),e.jsx(k,{className:"text-orange-400 cursor-pointer",onClick:()=>l(!0)})]})]})},D=({setIsModalOpen:p,order:s,handleUpdateOrder:d})=>{const[m,x]=n.useState(s.status),c=l=>{l.preventDefault(),v.patch(y+`/orders/${s.orderId}`,{status:m}).then(({data:t})=>{N(t.message),d(t.order)}).catch(()=>N("Oops! Something went wrong","error"))},r=n.useMemo(()=>s.orderItems.reduce((l,t)=>l+=t.price*t.quantity,0),[]);return e.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto  bg-gray-500 bg-opacity-50 flex justify-center items-center ",children:e.jsxs("div",{className:"relative bg-white rounded-lg shadow-lg max-w-md w-full mx-3",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 inline-flex items-center gap-2",children:"Update order"}),e.jsx("button",{type:"button",className:"text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm w-8 h-8 ms-auto flex justify-center items-center",onClick:()=>p(!1),children:e.jsx(I,{className:"w-4 h-4"})})]}),e.jsxs("form",{className:"p-4 md:p-5",onSubmit:c,children:[e.jsxs("div",{className:"grid gap-4 mb-4 grid-cols-4",children:[e.jsxs("div",{className:"col-span-4 md:col-span-2 bg-white dark:bg-gray-800",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Order Details"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold",children:"Order ID:"}),e.jsx("p",{className:"text-sm",children:s.orderId})]}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("p",{className:"text-sm font-semibold ",children:"Table Number :"}),e.jsx("p",{className:"text-sm",children:s.tableNumber})]}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("p",{className:"text-sm font-semibold ",children:"Total :"}),e.jsxs("p",{className:"text-sm",children:[" ₹",r]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("p",{className:"text-sm font-semibold mr-2",children:"Order Status:"}),e.jsxs("div",{className:"relative",children:[e.jsx("select",{className:"block appearance-none bg-white border border-gray-300 text-sm py-1 px-2 pr-8 rounded-md focus:outline-none focus:border-blue-500",value:m,onChange:l=>x(l.target.value),children:s.status==="Cancelled"?e.jsx("option",{value:"Cancelled",children:"Cancelled"}):e.jsxs(e.Fragment,{children:[e.jsx("option",{value:"Pending",children:"Pending"}),e.jsx("option",{value:"Confirmed",children:"Confirmed"}),e.jsx("option",{value:"InProgress",children:"In progress"}),e.jsx("option",{value:"Completed",children:"Completed"}),e.jsx("option",{value:"Cancelled",children:"Cancelled"})]})}),e.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center px-2 pointer-events-none",children:e.jsx(T,{})})]})]}),e.jsx("p",{className:"text-sm font-semibold",children:"Cutomer Details:"}),e.jsxs("p",{className:"text-sm inline-flex gap-2 ",children:[s.user.name," , ",s.mobile]})]})]}),e.jsx("div",{className:"col-span-4  md:col-span-2 ",children:e.jsx("ul",{className:"flex flex-col h-20 md:h-56 overflow-y-auto my-2 px-2",children:s.orderItems.map((l,t)=>e.jsxs("li",{className:"flex items-center justify-between py-2 border-b",children:[e.jsxs("span",{className:"flex-1",children:[l.quantity,"x ",l.item.name]}),e.jsxs("span",{className:"text-gray-700",children:["₹",l.price]})]},t))})})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{className:`text-white    bg-indigo-500 hover:bg-indigo-600
            focus:ring-indigo-400 focus:ring-2 focus:outline-none  font-medium rounded-lg
            text-sm px-5 py-2.5 text-center`,type:"submit",children:"Save"})})]})]})})},W=()=>{const[p,s]=n.useState([]),[d,m]=n.useState(null),[x,c]=n.useState(!1),r=b(),l=O(a=>a.UserSlice),{currentPage:t,setCurrentPage:g,pageSize:j,setPageSize:h,itemsPerPage:u,setItemsPerPage:f}=U();n.useEffect(()=>{v.get(y+"/orders",{params:{page:t}}).then(({data:a})=>{const{orders:i,count:o,limit:S}=a;s(i),h(o),f(S)}).catch(()=>N("Oops! Something went wrong","error"))},[t]);const w=a=>{s(i=>i.map(o=>o._id===a._id?{...o,status:a.status}:o)),c(!1)};return n.useEffect(()=>{r&&(r==null||r.emit("addUser",l.id),r==null||r.on("get_newOrder",a=>{s(i=>[a,...i])}))},[]),e.jsxs(e.Fragment,{children:[e.jsx("h1",{className:"mb-2 text-xl font-semibold ",children:"Orders"}),e.jsxs("div",{className:" overflow-x-auto shadow-md sm:rounded-lg custom-vh",children:[e.jsxs("table",{className:"w-full text-sm text-left rtl:text-right text-gray-500 dark:text-gray-400",children:[e.jsx("thead",{className:"text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-3",children:"SL:no"}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Order No"}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Table no"}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:"user"}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:"date"}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:"status"}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Action"})]})}),e.jsx("tbody",{children:p.map((a,i)=>n.createElement(E,{...a,key:a._id,index:i+1,setShowModal:o=>{c(o),m(a)}}))})]}),x&&d&&e.jsx(D,{setIsModalOpen:c,order:d,handleUpdateOrder:w}),e.jsx(A,{currentPage:t,totalCount:j,itemsPerPage:u,onPageChange:a=>g(a)})]})]})};export{W as default};
