import{g as S,r as d,d as M,u as G,U as N,H as q,j as r,N as z}from"./index-JE-bpBmX.js";import{a as K}from"./axios-B6xwUs71.js";import{N as X}from"./Navbar-CewZRdEQ.js";import{a as $}from"./axiosService-B1H-UEah.js";import{c as H}from"./util-OTU7ZyNy.js";import{C as V}from"./calendar-check-2-DtmFoN2B.js";import{C as Y}from"./clock-BIBkG2UT.js";import{U as J}from"./users-B_hK4hN1.js";import"./logo_copy-x91kgQhH.js";import"./reverseGeocode-DUgJrxOo.js";import"./index-D5A46URa.js";import"./chevron-down-BocSVaCI.js";import"./index-VWaDGczM.js";import"./logout-DB6qYUsy.js";import"./toaster-CbQaQdgB.js";var E="https://js.stripe.com/v3",Q=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/,I="loadStripe.setLoadParameters was called but an existing Stripe.js script already exists in the document; existing script parameters will be used",Z=function(){for(var o=document.querySelectorAll('script[src^="'.concat(E,'"]')),n=0;n<o.length;n++){var e=o[n];if(Q.test(e.src))return e}return null},P=function(o){var n="",e=document.createElement("script");e.src="".concat(E).concat(n);var a=document.head||document.body;if(!a)throw new Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return a.appendChild(e),e},D=function(o,n){!o||!o._registerWrapper||o._registerWrapper({name:"stripe-js",version:"3.3.0",startTime:n})},l=null,m=null,h=null,ee=function(o){return function(){o(new Error("Failed to load Stripe.js"))}},re=function(o,n){return function(){window.Stripe?o(window.Stripe):n(new Error("Stripe.js not available"))}},oe=function(o){return l!==null?l:(l=new Promise(function(n,e){if(typeof window>"u"||typeof document>"u"){n(null);return}if(window.Stripe&&o&&console.warn(I),window.Stripe){n(window.Stripe);return}try{var a=Z();if(a&&o)console.warn(I);else if(!a)a=P(o);else if(a&&h!==null&&m!==null){var c;a.removeEventListener("load",h),a.removeEventListener("error",m),(c=a.parentNode)===null||c===void 0||c.removeChild(a),a=P(o)}h=re(n,e),m=ee(e),a.addEventListener("load",h),a.addEventListener("error",m)}catch(x){e(x);return}}),l.catch(function(n){return l=null,Promise.reject(n)}))},te=function(o,n,e){if(o===null)return null;var a=o.apply(void 0,n);return D(a,e),a},f,C=!1,R=function(){return f||(f=oe(null).catch(function(o){return f=null,Promise.reject(o)}),f)};Promise.resolve().then(function(){return R()}).catch(function(t){C||console.warn(t)});var ne=function(){for(var o=arguments.length,n=new Array(o),e=0;e<o;e++)n[e]=arguments[e];C=!0;var a=Date.now();return R().then(function(c){return te(c,n,a)})};const ge=()=>{var _,w,y,j;const t=S(s=>s.BookingSlice),[o,n]=d.useState(!1),[e,a]=d.useState(null),[c,x]=d.useState(null),[u,b]=d.useState(null),[T,v]=d.useState({restaurantId:(e==null?void 0:e.restaurantId._id)??"",tableId:t.tableId,tableSlotId:t._id??"",paymentMethod:"Online"}),k=d.useRef(!0),L=M(),W=S(s=>s.UserSlice.id),F=G();d.useEffect(()=>{if(k.current)return K.get(N+`/tables/${t.tableId}?userId=${W}`).then(({data:s})=>{a(s.tableData),v(i=>({...i,restaurantId:s.tableData.restaurantId._id})),x(s.user.wallet)}).catch(()=>console.log("Error")),()=>{L(q())};k.current=!1},[k]);const U=t!=null&&t.slotDate?new Date(t.slotDate).toLocaleDateString("en-us",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):"",g=s=>{if(s==="Wallet"){if(H(e==null?void 0:e.capacity,e==null?void 0:e.restaurantId.tableRatePerPerson)>((c==null?void 0:c.balance)??0))return b("Insufficient balance");b(null)}s==="Online"&&b(null),v(i=>({...i,paymentMethod:s}))},A=async()=>{const s=await ne("pk_test_51Ox1KTSD6Onhv6FvlF3x1Dw9hYGDI4z2kddKoXInkxKzUxC7L2oiWl8OAurr8wmdgQGxSrN1D4UNHU8em1fNMthS00E4nbfqYq");n(!0),$.post(N+"/reserve_table",T).then(async({data:i})=>{if(i.id){const p=await(s==null?void 0:s.redirectToCheckout({sessionId:i.id}));p!=null&&p.error&&console.error(p.error)}const B=i.booking.bookingId;F(`/payment_status/${B}?success=true`)}).catch(i=>{console.log("Error in creating order"+i),n(!0)})},O=o||u!==null&&u.length>0;return t.tableId?r.jsxs(r.Fragment,{children:[r.jsx(X,{}),r.jsx("div",{className:"grid place-items-center h-screen mt-10 ",children:r.jsxs("div",{className:"w-full max-w-md bg-white p-6 rounded-md shadow-md space-y-2",children:[r.jsx("h3",{className:"text-2xl font-semibold mb-4 text-center",children:"Booking Summary"}),r.jsx("p",{className:"",children:r.jsx("span",{className:"text-2xl font-semibold",children:e==null?void 0:e.restaurantId.restaurantName})}),r.jsxs("div",{className:" flex gap-2",children:[r.jsx(V,{className:"h-5"}),r.jsx("p",{children:U})]}),r.jsxs("div",{className:" flex gap-2",children:[r.jsx(Y,{className:"h-5"}),r.jsxs("p",{children:[t==null?void 0:t.startTime," - ",t==null?void 0:t.endTime]})]}),r.jsxs("div",{className:" flex gap-2",children:[r.jsx(J,{}),r.jsxs("p",{children:[e==null?void 0:e.capacity," guests"]})]}),r.jsx("hr",{className:"bg-gray-200 "}),r.jsxs("div",{className:"bg-white  ",children:[r.jsx("h3",{className:"text-lg font-semibold ",children:"Total Charges"}),r.jsxs("p",{className:"",children:[r.jsx("span",{className:"font-semibold",children:"Price Per person:"})," ₹",(_=e==null?void 0:e.restaurantId)==null?void 0:_.tableRatePerPerson]}),r.jsxs("p",{className:"",children:[r.jsx("span",{className:"font-semibold",children:"GST (18%):"})," ₹",(18/100*((e==null?void 0:e.capacity)??0)*(((w=e==null?void 0:e.restaurantId)==null?void 0:w.tableRatePerPerson)??0)).toFixed(2)]}),r.jsxs("p",{className:"font-semibold mb-6",children:[r.jsx("span",{className:"font-semibold",children:"Total Amount:"})," ₹",(18/100*((e==null?void 0:e.capacity)??0)*(((y=e==null?void 0:e.restaurantId)==null?void 0:y.tableRatePerPerson)??0)+((e==null?void 0:e.capacity)??0)*(((j=e==null?void 0:e.restaurantId)==null?void 0:j.tableRatePerPerson)??0)).toFixed(2)]}),r.jsxs("p",{className:"font-semibold",children:["Wallet :",c==null?void 0:c.balance]}),r.jsxs("div",{className:"p-2",children:[r.jsx("label",{htmlFor:"inlineRadio1",className:"block mb-2 text-sm font-semibold text-gray-900 dark:text-white",children:"Payment Method"}),r.jsxs("div",{className:"flex",children:[r.jsxs("div",{className:"mb-[0.125rem] mr-4 inline-block min-h-[1.5rem] pl-[1.5rem]",children:[r.jsx("input",{className:"relative float-left -ml-[1.5rem] mr-1 mt-0.5 h-5 w-5 appearance-none rounded-full border-2 border-solid border-neutral-300 before:pointer-events-none before:absolute before:h-4 before:w-4 before:scale-0 before:rounded-full before:bg-transparent before:opacity-0 before:shadow-[0px_0px_0px_13px_transparent] before:content-[''] after:absolute after:z-[1] after:block after:h-4 after:w-4 after:rounded-full after:content-[''] checked:border-primary checked:before:opacity-[0.16] checked:after:absolute checked:after:left-1/2 checked:after:top-1/2 checked:after:h-[0.625rem] checked:after:w-[0.625rem] checked:after:rounded-full checked:after:border-primary checked:after:bg-primary checked:after:content-[''] checked:after:[transform:translate(-50%,-50%)] hover:cursor-pointer hover:before:opacity-[0.04] hover:before:shadow-[0px_0px_0px_13px_rgba(0,0,0,0.6)] focus:shadow-none focus:outline-none focus:ring-0 focus:before:scale-100 focus:before:opacity-[0.12] focus:before:shadow-[0px_0px_0px_13px_rgba(0,0,0,0.6)] focus:before:transition-[box-shadow_0.2s,transform_0.2s] checked:focus:border-primary checked:focus:before:scale-100 checked:focus:before:shadow-[0px_0px_0px_13px_#3b71ca] checked:focus:before:transition-[box-shadow_0.2s,transform_0.2s] dark:border-neutral-600 dark:checked:border-primary dark:checked:after:border-primary dark:checked:after:bg-primary dark:focus:before:shadow-[0px_0px_0px_13px_rgba(255,255,255,0.4)] dark:checked:focus:border-primary dark:checked:focus:before:shadow-[0px_0px_0px_13px_#3b71ca]",type:"radio",name:"paymentMethod",id:"inlineRadio2",value:"Online",defaultChecked:!0,onChange:()=>g("Online")}),r.jsx("label",{className:"mt-px inline-block pl-[0.15rem] hover:cursor-pointer",htmlFor:"inlineRadio2",children:"Online"})]}),r.jsxs("div",{className:"mb-[0.125rem] mr-4 min-h-[1.5rem] pl-[1.5rem] flex items-center",children:[r.jsx("input",{className:"relative float-left -ml-[1.5rem] mr-1 mt-0.5 h-5 w-5 appearance-none rounded-full border-2 border-solid border-neutral-300 before:pointer-events-none before:absolute before:h-4 before:w-4 before:scale-0 before:rounded-full before:bg-transparent before:opacity-0 before:shadow-[0px_0px_0px_13px_transparent] before:content-[''] after:absolute after:z-[1] after:block after:h-4 after:w-4 after:rounded-full after:content-[''] checked:border-primary checked:before:opacity-[0.16] checked:after:absolute checked:after:left-1/2 checked:after:top-1/2 checked:after:h-[0.625rem] checked:after:w-[0.625rem] checked:after:rounded-full checked:after:border-primary checked:after:bg-primary checked:after:content-[''] checked:after:[transform:translate(-50%,-50%)] hover:cursor-pointer hover:before:opacity-[0.04] hover:before:shadow-[0px_0px_0px_13px_rgba(0,0,0,0.6)] focus:shadow-none focus:outline-none focus:ring-0 focus:before:scale-100 focus:before:opacity-[0.12] focus:before:shadow-[0px_0px_0px_13px_rgba(0,0,0,0.6)] focus:before:transition-[box-shadow_0.2s,transform_0.2s] checked:focus:border-primary checked:focus:before:scale-100 checked:focus:before:shadow-[0px_0px_0px_13px_#3b71ca] checked:focus:before:transition-[box-shadow_0.2s,transform_0.2s] dark:border-neutral-600 dark:checked:border-primary dark:checked:after:border-primary dark:checked:after:bg-primary dark:focus:before:shadow-[0px_0px_0px_13px_rgba(255,255,255,0.4)] dark:checked:focus:border-primary dark:checked:focus:before:shadow-[0px_0px_0px_13px_#3b71ca]",type:"radio",name:"paymentMethod",id:"inlineRadio1",value:"Wallet",onChange:()=>g("Wallet")}),r.jsx("label",{className:"mt-px inline-block pl-[0.15rem] hover:cursor-pointer",htmlFor:"inlineRadio1",children:"Wallet"}),u&&r.jsx("p",{className:"text-red-500 ml-2",children:u})]})]})]})]}),r.jsx("button",{className:`w-full  px-4 py-2 bg-indigo-500 hover:bg-indigo-600
           text-white text-sm font-medium rounded-md`,onClick:A,disabled:O,children:o?"Submitting...":"Continue"})]})})]}):r.jsx(z,{to:"/",replace:!0})};export{ge as default};
