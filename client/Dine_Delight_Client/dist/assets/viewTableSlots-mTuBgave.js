import{j as e,h as F,u as D,r as d,R as v}from"./index-DLCA8CUi.js";import{B as P}from"./Button-ByhPp_XO.js";import{T as A}from"./trash-BscTm-rJ.js";import{a as k}from"./axiosService-BUADEq0L.js";import{s as S}from"./toaster-KMB571tZ.js";import{u as _,P as O}from"./usePaginateState-BOaB9aMD.js";import{c as E}from"./timeConverter-D2pGrZyb.js";import{a as B}from"./index-ChFGO7Uu.js";import{f as I}from"./util-D-aj_Cqt.js";import{C as z}from"./calendar-check-CjTJ5J8-.js";import{F as L}from"./filter-C6IhppNi.js";import"./axios-B6xwUs71.js";import"./index-VWaDGczM.js";import"./logout-DcSaUvZa.js";import"./Set_GetLs-jfIHgayU.js";const M=({sl_no:x,_id:m,slotDate:n,startTime:u,endTime:g,isAvailable:t,handleDeleteSlot:o})=>e.jsxs("tr",{className:"bg-white border-b dark:bg-gray-800 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600",children:[e.jsx("td",{scope:"row",className:"px-6 py-4 font-medium text-gray-900 whitespace-nowrap dark:text-white",children:x}),e.jsx("td",{className:"px-6 py-4",children:n&&new Date(n).toLocaleDateString("en-us",{day:"numeric",month:"numeric",year:"numeric"})}),e.jsxs("td",{className:"px-6 py-4",children:[u," - ",g]}),e.jsx("td",{className:"px-6 py-4",children:t?"Yes":"No"}),e.jsx("td",{className:"px-6 py-4 inline-flex gap-2",children:t?e.jsx(e.Fragment,{children:e.jsx("button",{className:"p-1 rounded-md bg-red-400 text-white font-semibold hover:bg-red-500 transition duration-150",onClick:()=>o(m??""),children:e.jsx(A,{})})}):null})]}),R=()=>{const{id:x}=F(),m=D(),[n,u]=d.useState([]),[g,t]=d.useState([]),{currentPage:o,setCurrentPage:N,pageSize:w,setPageSize:b,itemsPerPage:f,setItemsPerPage:y}=_(),[c,a]=d.useState({date:"",time:""}),[s,i]=d.useState(!1);return d.useEffect(()=>{(o||s&&(c.date.length||c.time.length))&&k.get(v+`/table_slots/${x}`,{params:{page:o,...s&&{date:c.date,time:E(c.time)}}}).then(({data:l})=>{const{tableSlot:r,count:h,limit:p}=l;t(r),b(h),y(p)}).catch(()=>{S("Oops! Something went wrong","error"),m("/restaurant/table")})},[o,s,c]),d.useEffect(()=>{k.get(v+"/time_slots").then(({data:l})=>{u(l.timeSlots)}).catch(()=>{S("Oops! Something went wrong","error"),m("/restaurant/table")})},[]),{tableSlot:g,timeslots:n,setCurrentPage:N,filter:c,setFilter:a,isFilterOn:s,setIsFilterOn:i,currentPage:o,pageSize:w,itemsPerPage:f,setTableSlot:t,handleAddedSlot:l=>t(r=>[...r,l]),handleDeleteSlot:l=>{k.delete(v+`/table_slots/${l}`).then(({data:r})=>{S(r.message);const h=g.filter(p=>p._id!==l);t(h)}).catch(()=>S("Oops! Something went wrong while deleting slot","error"))},handleFilterInputChange:l=>{const{name:r,value:h}=l.target;a(r==="time"?p=>({...p,time:h}):p=>({...p,date:new Date(h).toString()}))}}},$=({setIsModalOpen:x,addNewSlot:m,timeSlots:n})=>{const[u,g]=d.useState(!1),[t,o]=d.useState(null),N=D(),{id:w}=F(),[b,f]=d.useState({tableId:w??"",slotDate:"",selectTime:"",startTime:"",endTime:""}),y=a=>{const{name:s,value:i}=a.target;f(j=>({...j,[s]:i}))};function c(a){var l;a.preventDefault();const s=new FormData(a.currentTarget),i=((l=s.get("selectTime"))==null?void 0:l.toString())??"";i.length?(o(null),g(!0)):o({selectTime:"Please select a time"});const[j,C]=i.trim().split("-");s.append("startTime",j),s.append("endTime",C),s.append("tableId",b.tableId);let T={};for(let[r,h]of s.entries())typeof h=="string"&&(T[r]=h.trim());k.post(v+"/table_slots/allot",T).then(({data:r})=>{m(r.newSlot),S(r.message),x(!1)}).catch(({response:r})=>{S(r.data.message,"error"),g(!1)})}return e.jsx("div",{tabIndex:-1,"aria-hidden":"true",className:"fixed inset-0 z-50 overflow-y-auto bg-gray-500 bg-opacity-50 flex justify-center items-center ",children:e.jsxs("div",{className:"relative bg-white rounded-lg shadow-lg max-w-md w-full mx-3",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 inline-flex items-center gap-2",children:["Add table Slot ",e.jsx(z,{className:"text-orange-400"})]}),e.jsxs("button",{type:"button",className:"text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm w-8 h-8 ms-auto flex justify-center items-center",onClick:()=>x(!1),children:[e.jsx("svg",{className:"w-3 h-3","aria-hidden":"true",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 14 14",children:e.jsx("path",{stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"})}),e.jsx("span",{className:"sr-only",children:"Close modal"})]})]}),e.jsxs("form",{className:"p-4 md:p-5",onSubmit:c,children:[e.jsxs("div",{className:"grid gap-4 mb-4 grid-cols-4",children:[e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{htmlFor:"Slot Date",className:"block mb-2 text-sm font-medium text-gray-900 dark:text-white",children:"Slot Date"}),e.jsx("input",{type:"date",name:"slotDate",value:b.slotDate,min:I(new Date),onChange:y,className:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg outline-none block w-full p-2.5 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-600 dark:border-gray-500 dark:placeholder-gray-400 dark:text-white ",required:!0})]}),e.jsxs("div",{className:"col-span-2 ",children:[e.jsx("label",{htmlFor:`
                slot time`,className:"block mb-2 text-sm font-medium text-gray-900 dark:text-white",children:"Slot Time"}),n.length?e.jsxs(e.Fragment,{children:[e.jsx("select",{name:"selectTime",className:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 focus:outline-none block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500",onChange:y,children:n.map(a=>e.jsxs("option",{value:`${a.startTime} - ${a.endTime}`,children:[a.startTime," - ",a.endTime]},a._id))}),(t==null?void 0:t.selectTime)&&e.jsx("p",{className:"text-red-500",children:t==null?void 0:t.selectTime})]}):e.jsx(P,{label:"Add time Slot",className:"bg-orange-400 hover:bg-orange-500",handleButtonclick:()=>N("/restaurant/time_slots")})]})]}),e.jsx("button",{className:`text-white w-full  bg-green-500 hover:bg-green-600
           focus:ring-green-400 focus:ring-2 focus:outline-none  font-medium rounded-lg
           text-sm px-5 py-2.5 text-center`,type:"submit",children:u?e.jsxs("span",{className:"inline-flex items-center gap-2",children:[e.jsx(B,{className:"animate-spin mx-auto"}),"Adding"]}):"Add"})]})]})})},se=()=>{const[x,m]=d.useState(!1),{filter:n,tableSlot:u,setFilter:g,timeslots:t,pageSize:o,currentPage:N,itemsPerPage:w,isFilterOn:b,setIsFilterOn:f,setCurrentPage:y,handleAddedSlot:c,handleDeleteSlot:a,handleFilterInputChange:s}=R();return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between mb-2 ",children:[e.jsx("h1",{className:"text-xl font-semibold ",children:"Table Slots "}),e.jsx(P,{label:"Add Slots",className:"bg-orange-400 hover:bg-orange-500",handleButtonclick:()=>m(!0)})]}),e.jsxs("div",{className:"flex gap-2 mb-2 justify-center",children:[e.jsx("input",{type:"date",name:"date",value:I(new Date(n.date)),className:"border border-gray-300 rounded-md px-2 py-1",onChange:s}),e.jsx("input",{type:"time",name:"time",value:n.time,className:"border border-gray-300 rounded-md px-2 py-1",onChange:s}),e.jsxs("button",{className:"py-1 inline-flex gap-2 px-3 rounded-md bg-gray-400 text-white font-semibold hover:bg-gray-500 transition duration-150",onClick:()=>{f(!0)},children:["Filter ",e.jsx(L,{})]})," ",b&&(n.date.length||n.time.length)?e.jsx("button",{className:"py-1 inline-flex gap-2 px-3 rounded-md bg-gray-400 text-white font-semibold hover:bg-gray-500 transition duration-150",onClick:()=>{g({date:"",time:""}),f(!1)},children:"clear"}):null]}),u.length?e.jsx(e.Fragment,{children:e.jsxs("div",{className:" overflow-x-auto shadow-md sm:rounded-lg  custom-vh",children:[e.jsxs("table",{className:"w-full text-sm text-left rtl:text-right text-gray-500 dark:text-gray-400",children:[e.jsx("thead",{className:"text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-3",children:"SL:no"}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Date"}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Time"}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:"IsAvailable"}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Action"})]})}),e.jsx("tbody",{children:u.map((i,j)=>d.createElement(M,{...i,sl_no:j+1,key:i._id,handleDeleteSlot:a}))})]}),e.jsx(O,{currentPage:N,totalCount:o,itemsPerPage:w,onPageChange:i=>y(i)})]})}):e.jsx("div",{className:"flex gap-2 justify-center",children:e.jsx("h1",{className:"text-xl font-semibold ",children:"No Slot available "})}),x&&e.jsx($,{setIsModalOpen:m,addNewSlot:c,timeSlots:t})]})};export{se as default};
